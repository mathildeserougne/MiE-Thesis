#### ESTIMATING THE VULNERABILITY OF INDIAN TRADE ###

# Based on the EU communication, we have a list of HS codes for the vulnerable products.
# We use those HS codes to filter in an adequate way the BACI dataset.

# PACKAGES
install.packages(c("dplyr","readr","stringr","ggplot2"))
# Libraries
library(dplyr)
library(readr)
library(stringr)
library(ggplot2)

#### DATA WORK

# COMBINING 2013-2023
# file paths
file_paths <- paste0("~/work/BACI_Y", 2013:2023, ".csv")
# reading the files, adding each time a column for the corresponding year
baci_combined <- bind_rows(lapply(file_paths, function(file) {
  read_csv(file) %>%
    mutate(year = as.integer(str_replace(file, ".*Y(\\d{4}).*", "\\1"))) # year derived from the name of the csv
}))

# Country codes
country_codes <- read_csv("~/work/country_codes_V202501.csv")

# Renaming the columns
baci_combined <- baci_combined %>%
  rename(
    exporter = i,
    importer = j,
    product  = k,
    value    = v,
    quantity = q
  )

head(baci_combined)

# Merging baci with the country_codes to get country names for exporter and importer
baci_combined <- baci_combined %>%
  left_join(country_codes, by = c("exporter" = "country_code")) %>%
  rename(exporter_name = country_name) %>%
  left_join(country_codes, by = c("importer" = "country_code")) %>%
  rename(importer_name = country_name)


## INDIAN POV
# To get a lighter file, we build an "Indian POV" dataset

# Indian country code = 699 (see country_codes notice of the set)
baci_indian_pov <- baci_combined %>%
  filter(exporter == 699)  

head(baci_indian_pov)

# Saving the file
write_csv(baci_indian_pov, "baci_indian_pov.csv")









